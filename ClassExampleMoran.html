<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="generator" content="pandoc" />

    
        <meta name="date" content="2022-12-12" />
    
    <title>R code example</title>

        <script src="site_libs/header-attrs-2.17/header-attrs.js"></script>
        <script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <link href="site_libs/bootstrap-3.3.7/css/bootstrap.min.css" rel="stylesheet" />
        <script src="site_libs/bootstrap-3.3.7/js/bootstrap.min.js"></script>
        <script src="site_libs/navigation-1.1/tabsets.js"></script>
        <link href="site_libs/robobook-0.1/robobook.css" rel="stylesheet" />
        <link href="site_libs/robobook-0.1/robobook_fonts_embed.css" rel="stylesheet" />
        <script src="site_libs/robobook-0.1/robobook.js"></script>
    
    
        <style type="text/css">code{white-space: pre;}</style>
    <style type="text/css">
      pre > code.sourceCode { white-space: pre; position: relative; }
      pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
      pre > code.sourceCode > span:empty { height: 1.2em; }
      .sourceCode { overflow: visible; }
      code.sourceCode > span { color: inherit; text-decoration: inherit; }
      div.sourceCode { margin: 1em 0; }
      pre.sourceCode { margin: 0; }
      @media screen {
      div.sourceCode { overflow: auto; }
      }
      @media print {
      pre > code.sourceCode { white-space: pre-wrap; }
      pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
      }
      pre.numberSource code
        { counter-reset: source-line 0; }
      pre.numberSource code > span
        { position: relative; left: -4em; counter-increment: source-line; }
      pre.numberSource code > span > a:first-child::before
        { content: counter(source-line);
          position: relative; left: -1em; text-align: right; vertical-align: baseline;
          border: none; display: inline-block;
          -webkit-touch-callout: none; -webkit-user-select: none;
          -khtml-user-select: none; -moz-user-select: none;
          -ms-user-select: none; user-select: none;
          padding: 0 4px; width: 4em;
          background-color: #ffffff;
          color: #a0a0a0;
        }
      pre.numberSource { margin-left: 3em; border-left: 1px solid #a0a0a0;  padding-left: 4px; }
      div.sourceCode
        { color: #1f1c1b; background-color: #ffffff; }
      @media screen {
      pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
      }
      code span { color: #1f1c1b; } /* Normal */
      code span.al { color: #bf0303; background-color: #f7e6e6; font-weight: bold; } /* Alert */
      code span.an { color: #ca60ca; } /* Annotation */
      code span.at { color: #0057ae; } /* Attribute */
      code span.bn { color: #b08000; } /* BaseN */
      code span.bu { color: #644a9b; font-weight: bold; } /* BuiltIn */
      code span.cf { color: #1f1c1b; font-weight: bold; } /* ControlFlow */
      code span.ch { color: #924c9d; } /* Char */
      code span.cn { color: #aa5500; } /* Constant */
      code span.co { color: #898887; } /* Comment */
      code span.cv { color: #0095ff; } /* CommentVar */
      code span.do { color: #607880; } /* Documentation */
      code span.dt { color: #0057ae; } /* DataType */
      code span.dv { color: #b08000; } /* DecVal */
      code span.er { color: #bf0303; text-decoration: underline; } /* Error */
      code span.ex { color: #0095ff; font-weight: bold; } /* Extension */
      code span.fl { color: #b08000; } /* Float */
      code span.fu { color: #644a9b; } /* Function */
      code span.im { color: #ff5500; } /* Import */
      code span.in { color: #b08000; } /* Information */
      code span.kw { color: #1f1c1b; font-weight: bold; } /* Keyword */
      code span.op { color: #1f1c1b; } /* Operator */
      code span.ot { color: #006e28; } /* Other */
      code span.pp { color: #006e28; } /* Preprocessor */
      code span.re { color: #0057ae; background-color: #e0e9f8; } /* RegionMarker */
      code span.sc { color: #3daee9; } /* SpecialChar */
      code span.ss { color: #ff5500; } /* SpecialString */
      code span.st { color: #bf0303; } /* String */
      code span.va { color: #0057ae; } /* Variable */
      code span.vs { color: #bf0303; } /* VerbatimString */
      code span.wa { color: #bf0303; } /* Warning */
    </style>
    
    
    <!-- tabsets -->
    <script>
      $(document).ready(function () {
	  window.buildTabsets("toc");
      });
      $(document).ready(function () {
	  $('.tabset-dropdown > .nav-tabs > li').click(function () {
	      $(this).parent().toggleClass('nav-tabs-open')
	  });
      });
    </script>

    <!-- code folding -->
    
    <!-- code download -->
    
    <!-- tabsets dropdown -->

    <style type="text/css">
      .tabset-dropdown > .nav-tabs {
	  display: inline-table;
	  max-height: 500px;
	  min-height: 44px;
	  overflow-y: auto;
	  background: white;
	  border: 1px solid #ddd;
	  border-radius: 4px;
      }
      
      .tabset-dropdown > .nav-tabs > li.active:before {
	  content: "";
	  font-family: 'Glyphicons Halflings';
	  display: inline-block;
	  padding: 10px;
	  border-right: 1px solid #ddd;
      }
      
      .tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
	  content: "&#xe258;";
	  border: none;
      }
      
      .tabset-dropdown > .nav-tabs.nav-tabs-open:before {
	  content: "";
	  font-family: 'Glyphicons Halflings';
	  display: inline-block;
	  padding: 10px;
	  border-right: 1px solid #ddd;
      }
      
      .tabset-dropdown > .nav-tabs > li.active {
	  display: block;
      }

      .tabset-dropdown > .nav-tabs > li.active a {
  	  padding: 0 15px !important;
      }

      .tabset-dropdown > .nav-tabs > li > a,
      .tabset-dropdown > .nav-tabs > li > a:focus,
      .tabset-dropdown > .nav-tabs > li > a:hover {
	  border: none;
	  display: inline-block;
	  border-radius: 4px;
	  background-color: transparent;
      }
      
      .tabset-dropdown > .nav-tabs.nav-tabs-open > li {
	  display: block;
	  float: none;
      }
      
      .tabset-dropdown > .nav-tabs > li {
	  display: none;
	  margin-left: 0 !important;
      }
    </style>
    
</head>

<body class="preload">

   	
            <!-- robobook start -->   
   <div class="book with-summary">
      <div class="book-summary">
        <ul>
          <li class="title">R code example</li>
          <li class="divider"></li>
        </ul>
        <nav role="navigation" id="toc">
          <ul>
          <li><a href="#study-introduction"
          id="toc-study-introduction">Study Introduction</a>
          <ul>
          <li><a href="#background"
          id="toc-background">Background</a></li>
          <li><a href="#study-aim" id="toc-study-aim">Study aim</a></li>
          <li><a href="#data-description" id="toc-data-description">Data
          description</a></li>
          <li><a href="#spatial-weights-matrix"
          id="toc-spatial-weights-matrix">Spatial Weights
          Matrix</a></li>
          <li><a href="#morans-i" id="toc-morans-i">Moran’s I</a></li>
          </ul></li>
          </ul>
        </nav>
        <ul class="authors">
          <li class="divider"></li>
                               <li><span><i class="glyphicon glyphicon-calendar"></i> 2022-12-12</span></li>
                  </ul>     
      </div>
      <div class="book-body fixed">
        <div class="body-inner">
            <a class="btn pull-left js-toolbar-action toggle-sidebar" aria-label="Toggle Sidebar" title="Toggle Sidebar" href="#">
              <span class="glyphicon glyphicon-menu-hamburger"></span>
            </a>
            <div class="page-inner">
              <section id="content" class="normal">
      
   
      
      <div class="navbar navbar-default  navbar-fixed-top" role="navigation">
        <div class="container">
          <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="index.html">GEOG-364</a>
          </div>
          <div id="navbar" class="navbar-collapse collapse">
            <ul class="nav navbar-nav">
              <li>
        <a href="index.html">Home</a>
      </li>
      <li>
        <a href="index_GEOG364-22_Tutorial_R.html">R-TUTORIAL</a>
      </li>
      <li>
        <a href="ClassExampleMoran.html">CLASS EXAMPLE MORAN'S I LAB 6</a>
      </li>
      <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
          Labs
           
          <span class="caret"></span>
        </a>
        <ul class="dropdown-menu" role="menu">
          <li>
            <a href="index_GEOG364-22_L1Basics.html">Lab 1: R-Basics</a>
          </li>
          <li>
            <a href="index_GEOG364-22_L2EDA.html">Lab 2: Exploratory Analysis</a>
          </li>
          <li>
            <a href="index_GEOG364-22_L3Data.html">Lab 3: Data Wrangling</a>
          </li>
          <li>
            <a href="index_GEOG364-22_L4Firefly.html">Lab 4: Spatial Wrangling</a>
          </li>
          <li>
            <a href="index_GEOG364-22_L5Census.html">Lab 5: Census Data</a>
          </li>
          <li>
            <a href="index_GEOG364-22_L6SoviMoran.html">Lab 6: Moran SOVI</a>
          </li>
          <li>
            <a href="index_GEOG364-22_L7Point.html">Lab 7: Point Pattern</a>
          </li>
        </ul>
      </li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
              
            </ul>
          </div><!--/.nav-collapse -->
        </div><!--/.container -->
      </div><!--/.navbar -->
        
      <h1 class="title">R code example</h1>
      
        

   
      
   
<!-- Don't indent these lines or it will mess pre blocks indentation --> 
<p>**IF YOU WOULD LIKE TO DOWNLOAD THE CODE,</p>
<p><a
href="https://raw.githubusercontent.com/psu-spatial/Geog364-2022/main/ClassExampleMoran.Rmd"
class="uri">https://raw.githubusercontent.com/psu-spatial/Geog364-2022/main/ClassExampleMoran.Rmd</a>
RIGHT CLICK ON THIS AND CHOOSE SAVE AS. THIS WILL DOWNLOAD IT ONTO YOUR
COMPUTER</p>
<p>DON’T HIDE CODE CHUNKS IN LABS</p>
<div id="study-introduction" class="section level1">
<h1>Study Introduction</h1>
<div id="background" class="section level2">
<h2>Background</h2>
<p>Broadband access is an important part of accessing resources in
today’s society. From free educational materials, to the ability to know
when a hurricane is coming, the ability to use and access high speed
internet Florida is especially interesting because mix of rich/poor
areas, different political leanings, along with resident and tourist
areas.</p>
<div id="study-parameters" class="section level3">
<h3>Study parameters</h3>
<p>The data was collected from the American Community Survey, taken in
2019. ADD MORE…</p>
<ul>
<li><strong>OBJECT OF OBSERVATION:</strong> Per Person</li>
<li><strong>OBJECT OF ANALYSIS:</strong> Per County</li>
<li><strong>Data-set population:</strong> All the counties in Florida in
the 2019 American community survey</li>
<li><strong>Study population:</strong> Tourist heavy states in the USA
from 2019 to the present day (2022).</li>
<li><strong>Mark/Variable</strong>: Broadband access [in people per
county]</li>
</ul>
<p>Comparing the dataset and study populations we see that our data is a
sample of the study population. It is not randomly sampled out of all
years and locations although we hope its representative of the study
population, there are potentially some issues.</p>
<ul>
<li><p>The data was collected in a single year in 2019.</p></li>
<li><p>It was collected before COVID and rapid technological advances,
so may be out of date.</p></li>
<li><p>Equally, we assume that the county statistics are averaged across
all people in each county, but we know that the American Community
Survey is also biased to miss out undocumented and other vulnerable
populations, which are disproportionately less likely to have the
internet. So it might not be representative of our underlying goal of
examining broadband access</p></li>
</ul>
</div>
</div>
<div id="study-aim" class="section level2">
<h2>Study aim</h2>
<p>Dependent on the warnings above, the aim of this Lab is to examine
the spatial autocorrelation of broadband access across counties in
Florida, based on analysis of this dataset and more general research on
broadband access.</p>
<p>First we will assess the autocorrelation descriptively, attempting to
answer questions such as: Is it clustered/chess-board like? Is there 1st
order autocorrelation/2nd order? What are the potential patterns and
processes underlying them? I will also use tract data to examine
MAUP.</p>
<div id="initial-data-processing" class="section level3">
<h3>Initial data processing</h3>
<p>Note, I would normally hide this section. DO NOT DO THIS IN LABS OR
IT IS HARD TO GRADE</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># LIBRARIES</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggpubr)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(skimr)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(plotly)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(raster)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sp)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tmap)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(terra)</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rnaturalearth)</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(biscale)</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidycensus)</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cowplot)</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(units)</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(spdep)</span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># I use results=&quot;hide&quot; in the code chunk options to get rid of the output</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="co"># View this full screen to see the layout of the command more easily</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>ACS_county.sf <span class="ot">&lt;-</span> <span class="fu">get_acs</span>(<span class="at">geography =</span> <span class="st">&quot;county&quot;</span>, </span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>                         <span class="at">year =</span> <span class="dv">2019</span>,</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>                         <span class="at">variables =</span> <span class="fu">c</span>(<span class="at">housevalue  =</span> <span class="st">&quot;B25075_001&quot;</span>,  <span class="co"># house value</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">total_pop   =</span> <span class="st">&quot;B05012_001&quot;</span>,  <span class="co"># total population</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">total_house =</span> <span class="st">&quot;B25001_001&quot;</span>,  <span class="co"># no. houses</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">med.income  =</span> <span class="st">&quot;B19013_001&quot;</span>,  <span class="co"># median income  </span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">total_broad =</span> <span class="st">&quot;B28002_004&quot;</span>), <span class="co"># broadband  </span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>                         <span class="at">state =</span> <span class="fu">c</span>(<span class="st">&quot;FL&quot;</span>),</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>                         <span class="at">survey =</span> <span class="st">&quot;acs5&quot;</span>,<span class="at">geometry=</span><span class="cn">TRUE</span>,</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>                         <span class="at">output =</span> <span class="st">&quot;wide&quot;</span>,<span class="at">show_call=</span><span class="cn">FALSE</span>)</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>ACS_tract.sf <span class="ot">&lt;-</span> <span class="fu">get_acs</span>(<span class="at">geography =</span> <span class="st">&quot;tract&quot;</span>, </span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>                         <span class="at">year =</span> <span class="dv">2019</span>,</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>                         <span class="at">variables =</span> <span class="fu">c</span>(<span class="at">housevalue  =</span> <span class="st">&quot;B25075_001&quot;</span>,  <span class="co"># house value</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">total_pop   =</span> <span class="st">&quot;B05012_001&quot;</span>,  <span class="co"># total population</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">total_house =</span> <span class="st">&quot;B25001_001&quot;</span>,  <span class="co"># no. houses</span></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">med.income  =</span> <span class="st">&quot;B19013_001&quot;</span>,  <span class="co"># median income  </span></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">total_broad =</span> <span class="st">&quot;B28002_004&quot;</span>), <span class="co"># broadband  </span></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>                         <span class="at">state =</span> <span class="fu">c</span>(<span class="st">&quot;FL&quot;</span>),</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>                         <span class="at">survey =</span> <span class="st">&quot;acs5&quot;</span>,<span class="at">geometry=</span><span class="cn">TRUE</span>,</span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>                         <span class="at">output =</span> <span class="st">&quot;wide&quot;</span>,<span class="at">show_call=</span><span class="cn">FALSE</span>)</span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(ACS_county.sf)</span></code></pre></div>
<p>Importantly, we must ALSO remove missing census tracts, calculate any
density columns and change the map projection. I’m doing both counties
and census tracts, you only need to do one unless you want to understand
MAUP.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co">#-------</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="co"># COUNTIES</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co">#-------</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Change the map projection to UTM Florida (I googled the epsg code)</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>ACS_county.sf <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(ACS_county.sf,<span class="dv">6346</span>)</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the areas of each county </span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>ACS_county.sf<span class="sc">$</span>County.areaE <span class="ot">&lt;-</span> <span class="fu">st_area</span>(ACS_county.sf)</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Change the units of the areas from metres squared to km squared and overwrite</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>ACS_county.sf<span class="sc">$</span>County.areaE <span class="ot">&lt;-</span> <span class="fu">set_units</span>(ACS_county.sf<span class="sc">$</span>County.areaE,<span class="st">&quot;km^2&quot;</span>)</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a><span class="co"># and divide the total population by the area, save as new column</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>ACS_county.sf<span class="sc">$</span>PopulationDensityE <span class="ot">&lt;-</span>ACS_county.sf<span class="sc">$</span>total_popE <span class="sc">/</span>  ACS_county.sf<span class="sc">$</span>County.areaE</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a><span class="co"># and divide the total broadband by the number of houses, save as new column</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>ACS_county.sf<span class="sc">$</span>PercentHouse_Broadband <span class="ot">&lt;-</span>ACS_county.sf<span class="sc">$</span>total_broadE <span class="sc">/</span>  ACS_county.sf<span class="sc">$</span>total_houseE</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a><span class="co"># look for empty counties (lakes etc) and remove</span></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>tracts_empty <span class="ot">&lt;-</span> <span class="fu">st_is_empty</span>(ACS_county.sf)</span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>ACS_county.sf <span class="ot">&lt;-</span> ACS_county.sf[<span class="fu">which</span>(tracts_empty<span class="sc">==</span><span class="cn">FALSE</span>), ] </span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co">#-------</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="co"># TRACTS</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="co">#-------</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Change the map projection to UTM Florida (I googled the epsg code)</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>ACS_tract.sf <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(ACS_tract.sf,<span class="dv">6346</span>)</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the areas of each tract</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>ACS_tract.sf<span class="sc">$</span>Tract.areaE <span class="ot">&lt;-</span> <span class="fu">st_area</span>(ACS_tract.sf)</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Change the units of the areas from metres squared to km squared and overwrite</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>ACS_tract.sf<span class="sc">$</span>Tract.areaE <span class="ot">&lt;-</span> <span class="fu">set_units</span>(ACS_tract.sf<span class="sc">$</span>Tract.areaE,<span class="st">&quot;km^2&quot;</span>)</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a><span class="co"># and divide the total population by the area, save as new column</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>ACS_tract.sf<span class="sc">$</span>PopulationDensityE <span class="ot">&lt;-</span>ACS_tract.sf<span class="sc">$</span>total_popE <span class="sc">/</span>  ACS_tract.sf<span class="sc">$</span>Tract.areaE</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a><span class="co"># and divide the total broadband by the number of houses, save as new column</span></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>ACS_tract.sf<span class="sc">$</span>PercentHouse_Broadband <span class="ot">&lt;-</span>ACS_tract.sf<span class="sc">$</span>total_broadE <span class="sc">/</span>  ACS_tract.sf<span class="sc">$</span>total_houseE</span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a><span class="co"># look for empty tracts (lakes etc) and remove</span></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>tracts_empty <span class="ot">&lt;-</span> <span class="fu">st_is_empty</span>(ACS_tract.sf)</span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>ACS_tract.sf <span class="ot">&lt;-</span> ACS_tract.sf[<span class="fu">which</span>(tracts_empty<span class="sc">==</span><span class="cn">FALSE</span>), ] </span></code></pre></div>
</div>
<div id="looking-for-skewed-data" class="section level3">
<h3>Looking for skewed data</h3>
<p>Population density, wealth and housing density are often very skewed,
making the statistics hard. For example Moran’s I is inappropriate for
skewed data. To get around this and to see more detail outside cities,
we can take the log and save as a new column. For example</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>ACS_county.sf<span class="sc">$</span>Log_PopulationDensityE <span class="ot">&lt;-</span> <span class="fu">log</span>(ACS_county.sf<span class="sc">$</span>PopulationDensityE)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>ACS_county.sf<span class="sc">$</span>Log_PercentHouse_Broadband <span class="ot">&lt;-</span> <span class="fu">log</span>(ACS_county.sf<span class="sc">$</span>PercentHouse_Broadband)</span></code></pre></div>
<p>Comparing histograms:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(ACS_county.sf<span class="sc">$</span>PopulationDensityE,</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">main=</span><span class="fu">list</span>(<span class="st">&quot;Population Density&quot;</span>,<span class="at">cex=</span>.<span class="dv">7</span>),</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab=</span><span class="st">&quot;Population Density&quot;</span>)</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(ACS_county.sf<span class="sc">$</span>Log_PopulationDensityE,</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>     <span class="at">main=</span><span class="fu">list</span>(<span class="st">&quot;Log Population Density per Km^2&quot;</span>,<span class="at">cex=</span>.<span class="dv">7</span>),</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab=</span><span class="st">&quot;Population Density&quot;</span>)</span></code></pre></div>
<p><img src="ClassExampleMoran_files/figure-html/unnamed-chunk-6-1.png" width="768" /></p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>map1 <span class="ot">&lt;-</span> <span class="fu">qtm</span>(ACS_county.sf,<span class="at">fill=</span><span class="st">&quot;PopulationDensityE&quot;</span>,<span class="at">fill.palette=</span><span class="st">&quot;Greens&quot;</span>)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>map2 <span class="ot">&lt;-</span> <span class="fu">qtm</span>(ACS_county.sf,<span class="at">fill=</span><span class="st">&quot;Log_PopulationDensityE&quot;</span>,<span class="at">fill.palette=</span><span class="st">&quot;Greens&quot;</span>)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_arrange</span>(map1,map2)</span></code></pre></div>
<p><img src="ClassExampleMoran_files/figure-html/unnamed-chunk-6-2.png" width="768" /></p>
<p>I think that it’s clear that the log population density is less
skewed and more intuative than the total. E.g. 7 or 8 is a dense city, 0
or 1 is the countryside. Repeat for tract data. YOu can see that this is
so skewed that even taking the log doesn’t quite fix it.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>ACS_tract.sf<span class="sc">$</span>Log_PopulationDensityE <span class="ot">&lt;-</span> <span class="fu">log</span>(ACS_tract.sf<span class="sc">$</span>PopulationDensityE)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>ACS_tract.sf<span class="sc">$</span>Log_PercentHouse_Broadband <span class="ot">&lt;-</span> <span class="fu">log</span>(ACS_tract.sf<span class="sc">$</span>PercentHouse_Broadband)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(ACS_tract.sf<span class="sc">$</span>PopulationDensityE,</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>     <span class="at">main=</span><span class="fu">list</span>(<span class="st">&quot;Population Density&quot;</span>,<span class="at">cex=</span>.<span class="dv">7</span>),</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab=</span><span class="st">&quot;Population Density&quot;</span>)</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(ACS_tract.sf<span class="sc">$</span>Log_PopulationDensityE,</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>     <span class="at">main=</span><span class="fu">list</span>(<span class="st">&quot;Log Population Density per Km^2&quot;</span>,<span class="at">cex=</span>.<span class="dv">7</span>),</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab=</span><span class="st">&quot;Population Density&quot;</span>)</span></code></pre></div>
<p><img src="ClassExampleMoran_files/figure-html/unnamed-chunk-7-1.png" width="768" /></p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>map1 <span class="ot">&lt;-</span> <span class="fu">qtm</span>(ACS_tract.sf,<span class="at">fill=</span><span class="st">&quot;PopulationDensityE&quot;</span>,<span class="at">fill.palette=</span><span class="st">&quot;Greens&quot;</span>)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>map2 <span class="ot">&lt;-</span> <span class="fu">qtm</span>(ACS_tract.sf,<span class="at">fill=</span><span class="st">&quot;Log_PopulationDensityE&quot;</span>,<span class="at">fill.palette=</span><span class="st">&quot;Greens&quot;</span>)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_arrange</span>(map1,map2)</span></code></pre></div>
<p><img src="ClassExampleMoran_files/figure-html/unnamed-chunk-7-2.png" width="768" /></p>
<div id="check-for-broadband" class="section level5">
<h5>Check for Broadband</h5>
<p>Let’s do the same for our broadband access. We can see that the
original isn’t very skewed, so I don’t think we need a
transformation.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(ACS_county.sf<span class="sc">$</span>PercentHouse_Broadband,</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">main=</span><span class="fu">list</span>(<span class="st">&quot;Percent houses with broadband&quot;</span>,<span class="at">cex=</span>.<span class="dv">7</span>),</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab=</span><span class="st">&quot;% Broadband&quot;</span>)</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(ACS_county.sf<span class="sc">$</span>Log_PercentHouse_Broadband,</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>     <span class="at">main=</span><span class="fu">list</span>(<span class="st">&quot;Log Percent houses with broadband&quot;</span>,<span class="at">cex=</span>.<span class="dv">7</span>),</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab=</span><span class="st">&quot;Log % Broadband&quot;</span>)</span></code></pre></div>
<p><img src="ClassExampleMoran_files/figure-html/unnamed-chunk-8-1.png" width="768" /></p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>map1 <span class="ot">&lt;-</span> <span class="fu">qtm</span>(ACS_county.sf,<span class="at">fill=</span><span class="st">&quot;PercentHouse_Broadband&quot;</span>,<span class="at">fill.palette=</span><span class="st">&quot;Blues&quot;</span>)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>map2 <span class="ot">&lt;-</span> <span class="fu">qtm</span>(ACS_county.sf,<span class="at">fill=</span><span class="st">&quot;Log_PercentHouse_Broadband&quot;</span>,<span class="at">fill.palette=</span><span class="st">&quot;Blues&quot;</span>)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_arrange</span>(map1,map2)</span></code></pre></div>
<p><img src="ClassExampleMoran_files/figure-html/unnamed-chunk-8-2.png" width="768" /></p>
</div>
</div>
</div>
<div id="data-description" class="section level2">
<h2>Data description</h2>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>map_totalpop <span class="ot">&lt;-</span> <span class="fu">qtm</span>(ACS_county.sf,<span class="st">&quot;total_popE&quot;</span>,<span class="at">fill.palette=</span><span class="st">&quot;YlGnBu&quot;</span>)<span class="sc">+</span><span class="fu">tm_layout</span>(<span class="at">legend.outside =</span> <span class="cn">TRUE</span>)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>map_area     <span class="ot">&lt;-</span> <span class="fu">qtm</span>(ACS_county.sf,<span class="st">&quot;County.areaE&quot;</span>)<span class="sc">+</span><span class="fu">tm_layout</span>(<span class="at">legend.outside =</span> <span class="cn">TRUE</span>)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>map_popdens  <span class="ot">&lt;-</span> <span class="fu">qtm</span>(ACS_county.sf,<span class="st">&quot;PopulationDensityE&quot;</span>,<span class="at">fill.palette=</span><span class="st">&quot;Greens&quot;</span>)<span class="sc">+</span><span class="fu">tm_layout</span>(<span class="at">legend.outside =</span> <span class="cn">TRUE</span>)</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>map_income  <span class="ot">&lt;-</span> <span class="fu">qtm</span>(ACS_county.sf,<span class="st">&quot;med.incomeE&quot;</span>,<span class="at">fill.palette=</span><span class="st">&quot;Purples&quot;</span>)<span class="sc">+</span><span class="fu">tm_layout</span>(<span class="at">legend.outside =</span> <span class="cn">TRUE</span>)</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_mode</span>(<span class="st">&quot;plot&quot;</span>)</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="fu">suppressWarnings</span>(<span class="fu">tmap_arrange</span>(map_totalpop,map_area,map_popdens,map_income))</span></code></pre></div>
<p><img src="ClassExampleMoran_files/figure-html/unnamed-chunk-9-1.png" width="768" /></p>
<p>We can see clear clusters around major cities. They tend to be richer
and have a higher population density. Orlando and disney world also
stand out. There is an interestingly rich county in the north east that
appears to be quite rural. If this was an actual lab I would google it
and write a sentence on it.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># better maps</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="co"># create map 1</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>map1 <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(ACS_county.sf,  <span class="at">unit =</span> <span class="st">&quot;mi&quot;</span>) <span class="sc">+</span>                      </span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>           <span class="fu">tm_polygons</span>(<span class="at">col=</span><span class="st">&quot;total_broadE&quot;</span>,    </span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>                       <span class="at">style=</span><span class="st">&quot;pretty&quot;</span>,    </span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>                       <span class="co">#border.col = NULL,  </span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>                       <span class="at">border.alpha =</span> <span class="fl">0.1</span>, </span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>                       <span class="at">palette=</span><span class="st">&quot;YlGnBu&quot;</span>,</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>                       <span class="at">title =</span> <span class="st">&quot;&quot;</span>, <span class="co"># using the more sophisticated tm_layout command</span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>                       <span class="at">legend.hist =</span> <span class="cn">TRUE</span>)   <span class="sc">+</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_scale_bar</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">10</span>, <span class="dv">20</span>)) <span class="sc">+</span></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">main.title =</span> <span class="st">&quot;Total Dwellings with Broadband&quot;</span>,  <span class="at">main.title.size =</span> <span class="fl">0.95</span>, <span class="at">frame =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">legend.outside =</span> <span class="cn">TRUE</span>) </span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a><span class="co"># create map 2</span></span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>map2 <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(ACS_county.sf, <span class="at">unit =</span> <span class="st">&quot;mi&quot;</span>) <span class="sc">+</span> </span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>           <span class="fu">tm_polygons</span>(<span class="at">col =</span> <span class="st">&quot;PercentHouse_Broadband&quot;</span>, </span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>                       <span class="at">style =</span> <span class="st">&quot;quantile&quot;</span>,</span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>                       <span class="at">palette =</span> <span class="st">&quot;Reds&quot;</span>, </span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>                       <span class="at">border.alpha =</span> <span class="fl">0.1</span>, </span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>                       <span class="at">title =</span> <span class="st">&quot;&quot;</span>) <span class="sc">+</span>  <span class="co"># using the more sophisticated tm_layout command</span></span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_scale_bar</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">10</span>, <span class="dv">20</span>)) <span class="sc">+</span></span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_compass</span>(<span class="at">type =</span> <span class="st">&quot;4star&quot;</span>, <span class="at">position =</span> <span class="fu">c</span>(<span class="st">&quot;left&quot;</span>, <span class="st">&quot;bottom&quot;</span>)) <span class="sc">+</span> </span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">main.title =</span> <span class="st">&quot;Percentage of dwellings with broadband &quot;</span>,  <span class="at">main.title.size =</span> <span class="fl">0.95</span>, <span class="at">frame =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">legend.outside =</span> <span class="cn">TRUE</span>) </span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_options</span>(<span class="at">check.and.fix =</span> <span class="cn">TRUE</span>)</span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-29"><a href="#cb13-29" aria-hidden="true" tabindex="-1"></a><span class="co"># and print</span></span>
<span id="cb13-30"><a href="#cb13-30" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_arrange</span>(map1,map2)</span></code></pre></div>
<p><img src="ClassExampleMoran_files/figure-html/unnamed-chunk-10-1.png" width="768" /></p>
<p>Looking at the plots above, there appears to be some clustering,
especially around cities. This makes sense given that urban areas are
often prioritised for broadband access.</p>
<p>I assume there will also be problems with MAUP. Note, I’m choosing
many palettes so you can see how the code works..</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>map3 <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(ACS_tract.sf,  <span class="at">unit =</span> <span class="st">&quot;mi&quot;</span>) <span class="sc">+</span>                      </span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>           <span class="fu">tm_polygons</span>(<span class="at">col=</span><span class="st">&quot;total_broadE&quot;</span>,    </span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>                       <span class="at">style=</span><span class="st">&quot;jenks&quot;</span>,    </span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>                       <span class="at">border.col =</span> <span class="cn">NULL</span>, <span class="at">title=</span><span class="st">&quot;&quot;</span>, </span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>                       <span class="at">palette=</span><span class="st">&quot;viridis&quot;</span>)   <span class="sc">+</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">title =</span> <span class="st">&quot;Total Dwellings with Broadband&quot;</span>,  <span class="at">title.size =</span> <span class="fl">0.95</span>, <span class="at">frame =</span> <span class="cn">FALSE</span>)<span class="sc">+</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">legend.outside =</span> <span class="cn">TRUE</span>) </span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>map4 <span class="ot">&lt;-</span> <span class="fu">tm_shape</span>(ACS_tract.sf, <span class="at">unit =</span> <span class="st">&quot;mi&quot;</span>) <span class="sc">+</span> </span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>           <span class="fu">tm_polygons</span>(<span class="at">col =</span> <span class="st">&quot;PercentHouse_Broadband&quot;</span>, </span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>                       <span class="at">style =</span> <span class="st">&quot;pretty&quot;</span>,</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>                       <span class="at">palette =</span> <span class="st">&quot;magma&quot;</span>, </span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>                       <span class="at">border.alpha =</span> <span class="dv">0</span>, </span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>                       <span class="at">title =</span> <span class="st">&quot;&quot;</span>) <span class="sc">+</span>  <span class="co"># using the more sophisticated tm_layout command</span></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_scale_bar</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">10</span>, <span class="dv">20</span>)) <span class="sc">+</span></span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">frame =</span> <span class="cn">FALSE</span>, <span class="at">title =</span> <span class="st">&quot;Percentage of dwellings with broadband&quot;</span>,  <span class="at">main.title.size =</span> <span class="fl">0.95</span>)<span class="sc">+</span></span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_layout</span>(<span class="at">legend.outside =</span> <span class="cn">TRUE</span>) </span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a><span class="fu">tmap_options</span>(<span class="at">check.and.fix =</span> <span class="cn">TRUE</span>)</span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a><span class="co"># and print</span></span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a><span class="fu">suppressMessages</span>(<span class="fu">tmap_arrange</span>(map3,map4))</span></code></pre></div>
<p><img src="ClassExampleMoran_files/figure-html/unnamed-chunk-11-1.png" width="768" /></p>
<p>There is clearly both a shape and zone effect. The larger size of the
county is masking some of the underlying patterns, and although there
are county level reasons why internet access might differ (township
rules etc), its likely that we would miss some nuance by just looking at
counties. For example, Miami is dominating the county level average, but
really the census tracts doing this are almost too small to see.</p>
</div>
<div id="spatial-weights-matrix" class="section level2">
<h2>Spatial Weights Matrix</h2>
<p>Because of MAUP, I will continue with both the county and the tract
data. I need spatial weights matrices for both.</p>
<div id="county" class="section level4">
<h4>County</h4>
<p>Note how careful I am being with variable names</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># make an sp version</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>ACS_county.sp <span class="ot">&lt;-</span> <span class="fu">as</span>(ACS_county.sf,<span class="st">&quot;Spatial&quot;</span>)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate the spatial weights matrix, I put  zero.policy = T to capture missing data</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>matrix.queen.county <span class="ot">&lt;-</span><span class="fu">poly2nb</span>(ACS_county.sp, <span class="at">queen=</span>T)</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate the spatial weights</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>weights.queen.county <span class="ot">&lt;-</span> <span class="fu">nb2listw</span>(matrix.queen.county, <span class="at">style=</span><span class="st">&#39;B&#39;</span>, <span class="at">zero.policy =</span> T)</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a><span class="co"># looks interlinked!</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(matrix.queen.county, <span class="fu">coordinates</span>(ACS_county.sp), <span class="at">col=</span><span class="st">&#39;black&#39;</span>, <span class="at">lwd=</span><span class="dv">1</span>, <span class="at">cex=</span>.<span class="dv">2</span>)</span></code></pre></div>
<p><img src="ClassExampleMoran_files/figure-html/unnamed-chunk-12-1.png" width="768" /></p>
</div>
<div id="tract" class="section level4">
<h4>Tract</h4>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># make an sp version</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>ACS_tract.sp <span class="ot">&lt;-</span> <span class="fu">as</span>(ACS_tract.sf,<span class="st">&quot;Spatial&quot;</span>)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate the spatial weights matrix, I put  zero.policy = T to capture missing data</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>matrix.queen.tract <span class="ot">&lt;-</span><span class="fu">poly2nb</span>(ACS_tract.sp, <span class="at">queen=</span>T)</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate the spatial weights</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>weights.queen.tract <span class="ot">&lt;-</span> <span class="fu">nb2listw</span>(matrix.queen.tract, <span class="at">style=</span><span class="st">&#39;B&#39;</span>, <span class="at">zero.policy =</span> T)</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a><span class="co"># looks interlinked!</span></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(matrix.queen.tract, <span class="fu">coordinates</span>(ACS_tract.sp), <span class="at">col=</span><span class="st">&#39;black&#39;</span>, <span class="at">lwd=</span><span class="dv">1</span>, <span class="at">cex=</span>.<span class="dv">2</span>)</span></code></pre></div>
<p><img src="ClassExampleMoran_files/figure-html/unnamed-chunk-13-1.png" width="768" /></p>
</div>
</div>
<div id="morans-i" class="section level2">
<h2>Moran’s I</h2>
<p>FOR ANY VARIABLE/MARK, we can calculate both a Moran’s scatterplot
and a global statisic, Moran’s I, along with a hypothesis test.</p>
<p>Here we look at total broadband by both county and tract</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">moran.plot</span>(ACS_county.sf<span class="sc">$</span>total_broadE, </span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>           <span class="at">listw=</span> weights.queen.county,</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">labels=</span>ACS_county.sf<span class="sc">$</span>NAME,</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">xlab =</span> <span class="st">&quot;BB: total broadband access / total houses per county&quot;</span>,</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">ylab =</span> <span class="st">&quot;Average BB for QUEEN NEIGHBOURS&quot;</span>,</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>           <span class="at">zero.policy =</span> T)</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a><span class="fu">moran.plot</span>(ACS_tract.sf<span class="sc">$</span>total_broadE, </span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>           <span class="at">listw=</span> weights.queen.tract,<span class="at">labels=</span>ACS_tract.sf<span class="sc">$</span>NAME,</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>           <span class="at">xlab =</span> <span class="st">&quot;BB: total broadband access / total houses per census tract&quot;</span>,</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>           <span class="at">ylab =</span> <span class="st">&quot;Average BB for QUEEN NEIGHBOURS&quot;</span>,</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>           <span class="at">zero.policy =</span> T)</span></code></pre></div>
<p>We can see in both cases that there appears to be positive
autocorrelation (e.g. the correlation coefficient/moran’s I is &gt; 0),
although the census tract data is dominated by Census tract 9112 in
Sumter county. Googling this, I can’t see any reason this might be the
case, so I would go back and carefully look at the data. <a
href="https://data.gainesville.com/american-community-survey/sumter-county-florida/population/total-population/yty/05000US12119/"
class="uri">https://data.gainesville.com/american-community-survey/sumter-county-florida/population/total-population/yty/05000US12119/</a></p>
<p>Let’s do a moran’s test on the county level broadband access, to
assess if it is more clustered than we would expect from a randomly
generated pattern.</p>
<p>H0: We hypothesise that an IRP caused this pattern. If this was true
the average Moran’s I would be I=0 H1: The data appears to be MORE
clustered than expected from a pattern caused by an IRP. Moran’s I, I
&gt; 0</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">moran.test</span>(ACS_county.sf<span class="sc">$</span>total_broadE, </span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>           <span class="at">listw=</span> weights.queen.county,</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">zero.policy =</span> T)</span></code></pre></div>
<pre><code>## 
##  Moran I test under randomisation
## 
## data:  ACS_county.sf$total_broadE  
## weights: weights.queen.county    
## 
## Moran I statistic standard deviate = 4.0572, p-value = 2.483e-05
## alternative hypothesis: greater
## sample estimates:
## Moran I statistic       Expectation          Variance 
##       0.277767027      -0.015151515       0.005212347</code></pre>
<p>We can see that</p>
<ol style="list-style-type: decimal">
<li>the expected Moran’s I from an IRP would be -0.15 (not zero due to
the non uniformity of space and edge effects).</li>
<li>the actual Moran’s I from our dataset is 0.278.</li>
<li>And… the probability of seeing something that extreme if H0 really
was true is tiny, 0.000002483. E.g. you would only see something this
clustered by chance one in ~40000 times.</li>
</ol>
<p>So given that the p value is so small and the chance is so slim, we
have enough evidence to REJECT H0 and suggest that the data is more
clustered than expected from an IRP, so maybe another process is going
on,.</p>
<div id="census-tract-hypothesis-test" class="section level4">
<h4>Census tract Hypothesis test</h4>
<p>How does it look at different scales? This is a good way to
understand effect vs significance</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">moran.test</span>(ACS_tract.sf<span class="sc">$</span>total_broadE, </span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>           <span class="at">listw=</span> weights.queen.tract,</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">zero.policy =</span> T)</span></code></pre></div>
<pre><code>## 
##  Moran I test under randomisation
## 
## data:  ACS_tract.sf$total_broadE  
## weights: weights.queen.tract  n reduced by no-neighbour observations
##   
## 
## Moran I statistic standard deviate = 33.29, p-value &lt; 2.2e-16
## alternative hypothesis: greater
## sample estimates:
## Moran I statistic       Expectation          Variance 
##      2.881460e-01     -2.377556e-04      7.504256e-05</code></pre>
<p><em>IRP = independent random process.</em></p>
<p>H0: I hypothesise that an IRP caused this pattern. If this was true
the average Moran’s I would be I=0 H1: The data appears to be MORE
clustered than expected from a pattern caused by an IRP. Moran’s I, I
&gt; 0</p>
<p>We see that:</p>
<ol style="list-style-type: decimal">
<li>the expected Moran’s I from an IRP would be -2.377556e-04</li>
<li>the actual Moran’s I from our dataset is 0.2888. (note this is the
same as before but they wrote it out in science notation)</li>
<li>And… the probability of seeing something that extreme if H0 really
was true is now essentially zero, 2.2e-16. E.g. the sun would be more
likely to explode right now than seeing something this clustered,</li>
</ol>
<p>So here we see the two components of a test.</p>
<p>The EFFECT SIZE: how clustered/uniform is it. The SIGNIFICANCE: how
likely is it to have seen the result if I repeated it and H0 was
true.</p>
<p>For example, if I take a single hair from my head, I will
“significantly” lose weight (e.g. if I repeated this a thousand times,
I’m not likely to put weight on!), But… the effect size itself is
meaningles..</p>
</div>
</div>
</div>

   
   
           </section>
  </div>
  </div>
  </div>
  </div>
      
      

  <script>
    $(document).ready(function () {

		// add bootstrap table styles to pandoc tables
	$('tr.header').parent('thead').parent('table').addClass('table table-condensed');
		
 		
	    });
  </script>



    <!-- dynamically load mathjax for compatibility with self-contained -->
  <script>
    (function () {
	var script = document.createElement("script");
	script.type = "text/javascript";
	script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
	document.getElementsByTagName("head")[0].appendChild(script);
    })();
  </script>
  
</body>
</html>
